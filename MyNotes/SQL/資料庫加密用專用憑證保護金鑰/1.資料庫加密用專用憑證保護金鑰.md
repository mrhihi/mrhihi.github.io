### 如何在 SQL Server 上，建立憑證簽名請求( CSR - Certificate Signing Request ) 。

利用 Windows Server 的 Microsoft 管理主控台( MMC - Microsoft Management Console ) 建立 CSR 。

請依下列步驟執行建立 CSR ：

1. 以 Windows Server 2019 為列，在「開始」圖示上，按「右鍵」，並選擇「執行」。
   ![](./images/截圖%202021-03-15%2008.52.52.png)

   
2. 在「執行視窗」中的 「開啟輸入文字方塊」裡，輸入「 mmc 」後，按下「確定」。
   ![截圖 2021-03-15 08.53.03](./images/截圖%202021-03-15%2008.53.03.png)

   
3. 前步驟完成後，會出現「主控台」視窗，在「檔案」選單裡，選擇「新增/移除嵌入式管理單元」。
   ![截圖 2021-03-15 08.53.25](./images/截圖%202021-03-15%2008.53.25.png)

   
4. 上步驟完成後，會出現「新增或移除嵌入式管理單元」視窗，在該視窗中的「可用的嵌入式管理單元」清單中，選擇「憑證」，並按視窗中間的「新增」按鈕。
   ![截圖 2021-03-15 08.53.43](./images/截圖%202021-03-15%2008.53.43.png)

   
5. 上步驟按下「新增」按鈕後，會出現「憑證嵌入式管理單元」視窗，請選譯「電腦帳戶」，並按「下一步」。
   ![截圖 2021-03-15 08.53.54](./images/截圖%202021-03-15%2008.53.54.png)

   
6. 接著，出現「選取電腦」視窗，請選擇「本機電腦（執行這個主控台的電腦）」選項，並按下「完成」。
   ![截圖 2021-03-15 08.54.05](./images/截圖%202021-03-15%2008.54.05.png)

   
7. 以上步驟完成，即可將「憑證」管理單元新增至右方「選取的嵌入式管理單元」中，完成結果如下圖，此步驟完成後，請按下「確定」。
   ![截圖 2021-03-15 08.54.16](./images/截圖%202021-03-15%2008.54.16.png)

   
8. 前面完成將「憑證管理單元」加入主控台，結果如下，請「點選」左邊「憑證（本機電腦）」，點選後，右邊「邏輯存放區名稱」會出現清單，請在「個人」的項目上，按「右鍵」選擇「所以有工作」中的「進階操作」，然後點擊「建立自訂要求」。
   ![截圖 2021-03-15 08.54.43](./images/截圖%202021-03-15%2008.54.43.png)

   
9. 上步驟完成後，會現「在您開始前」視窗，如下圖，請點選「下一步」。
   ![截圖 2021-03-15 08.54.52](./images/截圖%202021-03-15%2008.54.52.png)

   
10. 接著，會現「選取憑證註冊原則」視窗，依預設，選擇「在沒有註冊原則的情況下繼續」如下圖，並點選「下一步」。
    ![截圖 2021-03-15 08.55.01](./images/截圖%202021-03-15%2008.55.01.png)

    
11. 在「自訂要求」視窗中，「範本」下拉選項，請下拉並選擇「（沒有範本）舊版金鑰」(務必選擇舊版金鑰，否則無法匯入 SQL Server)，「要求格式」依預設選擇 PKCS #10(P)，並按「下一步」以繼續。
    ![截圖 2021-03-15 08.55.15](./images/截圖%202021-03-15%2008.55.15.png)

    
12. 在「憑證資訊」視窗中，請將滑鼠移到「詳給資料」旁邊的「向下箭頭」圖示，「點擊」該圖示，展開「詳細資料」內容，展開後的內容，如步驟 13 中的圖片。
    ![截圖 2021-03-15 08.55.42](./images/截圖%202021-03-15%2008.55.42.png)

    
13. 請「點擊」「內容」按鈕。
    ![截圖 2021-03-15 08.55.51](./images/截圖%202021-03-15%2008.55.51.png)

    
14. 上述步驟完成後，會出現「憑證內容」視窗，在「一般」頁籤中，依畫面所示，輸入實際的資料。
    ![截圖 2021-03-15 08.56.32](./images/截圖%202021-03-15%2008.56.32.png)

    
15. 在「主體」頁籤中，請利用視窗左邊「主體名稱」裡的類型，填入憑證所需的相關資訊(國家/地區、省份、組織 ... 等)，填好的項目要用視窗中間的「新增」按鈕，移到右邊，才會把填好的資訊紀錄在憑證的主體中，待全部資訊填妥後，請移到下一個頁籤「延伸」。
    ![截圖 2021-03-15 08.58.11](./images/截圖%202021-03-15%2008.58.11.png)
    ![截圖 2021-03-15 08.56.45](./images/截圖%202021-03-15%2008.56.45.png)


16. 「延伸」頁籤畫面如下，請展開「金鑰使用方式」，在視窗左邊的「可用的選項」清單中，利將視窗中間的「新增按鈕」，將「數位簽章」、「金鑰憑證簽署」、「金鑰編密」加到視窗右邊的「已選取選項」中，選取完成後，可將「金鑰使用方式」收起，並展開「擴充金鑰使用方式（應用程式原則）」以便繼續下個步驟。
    ![截圖 2021-03-15 08.59.10](./images/截圖%202021-03-15%2008.59.10.png)
    ![截圖 2021-03-15 10.40.29](./images/截圖%202021-03-15%2010.40.29.png)

    
17. 在「擴充金鑰使用方式（應用程式原則）」中，請在視窗左邊的「可用的選項」裡，選取「伺服器驗證」並利用視窗中間的「新增」按鈕，加入視窗右邊的「已選取選項」清單中，完成後，可以移至下個頁籤「私密金鑰」。
    ![截圖 2021-03-15 10.39.33](./images/截圖%202021-03-15%2010.39.33.png)

    

18. 在「私密金鑰」頁籤中，請展開「金鑰選項」，將「金鑰大小」指定為「 2048 」，並勾選「可匯出私密金鑰」以及「允許保存私密金鑰」（務必要勾選，否則無法匯入 SQL Server ），完成後，便可點擊「確定」完成憑證詳細內容的設定。
    ![截圖 2021-03-15 09.00.31](./images/截圖%202021-03-15%2009.00.31.png)

    

19. 憑證詳細內容設定完成後，結果如下圖。
    ![截圖 2021-03-15 10.38.28](./images/截圖%202021-03-15%2010.38.28.png)


20. 最後，按下一步後，請選擇 CSR 檔案欲儲存的位置，並輸入完整檔案名稱及副檔名(.csr)，按下「完成」後，便可在指定的檔案位置找到輸出的憑證請求檔。
    ![截圖 2021-03-15 09.01.57](./images/截圖%202021-03-15%2009.01.57.png)
	