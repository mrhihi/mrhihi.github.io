# 從 Git 的歷程裡面清除所有敏感資料

參考 Github [建議的做法](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository)

用 [BFG Repo-Cleaner](https://rtyley.github.io/bfg-repo-cleaner/) 實作

## 安裝

macOS 可以直接透過 Homebrew 安裝即可： [連結](https://formulae.brew.sh/formula/bfg)

```shell
brew install bfg
```

過程中會需要 javasdk ，brew 會自動安裝 OpenJDK

## 執行

* Step 1
  * 先把要刪、要改的檔案，照正常程序刪除、修改，並 commit ，commit 完之後先不用 push 回去
* Step 2
  * 執行 bfg 指令清除紀錄

指定要清除的檔案，不用指定路徑，只要給檔案的名子就好

```shell
bfg --delete-files YOUR-FILE-WITH-SENSITIVE-DATA
```

指定要清除的目錄，不用指定路徑，只要給目錄的名字就好

```shell
bfg --delete-folders YOUR-FILE-WITH-SENSITIVE-DATA
```

指定要從歷程差異中清除的文字，清除的文字列表放在 sensitive.txt 文字檔中(一行放一個)

```shell
bfg --replace-text sensitive.txt
```

執行完成後，依 bfg 提示的命令執行善後工作

```shell
git reflog expire --expire=now --all && git gc --prune=now --aggressive
```

最後再 push 回去

```shell
git push --force
```
